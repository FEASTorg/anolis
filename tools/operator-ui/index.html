<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Anolis Control Dashboard</title>
    <link rel="icon" href="anolis_logo_1024.ico" type="image/x-icon">
    <link rel="shortcut icon" href="anolis_logo_1024.ico" type="image/x-icon">
    <meta name="msapplication-TileImage" content="anolis_logo_1024.ico">
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
      <div id="error-banner" class="error-banner hidden">
        <span class="error-icon">⚠</span>
        <span id="error-banner-message"></span>
        <button id="error-banner-dismiss" class="btn-dismiss">×</button>
      </div>
      
      <div class="header-main">
        <h1>Anolis Control Dashboard</h1>
        <span class="header-subtitle">Runtime Automation &amp; Device Monitoring</span>
      </div>
      
      <nav class="header-tabs">
        <button id="tab-dashboard" class="tab-button active" data-view="dashboard">Dashboard</button>
        <button id="tab-devices" class="tab-button" data-view="devices">Devices</button>
        <button id="tab-telemetry" class="tab-button" data-view="telemetry">Telemetry</button>
      </nav>
      
      <div class="header-status">
        <div class="status-item">
          <span class="label">Runtime:</span>
          <span id="runtime-badge" class="badge unknown">Unknown</span>
        </div>
        <div class="status-item">
          <span class="label">Stream:</span>
          <span id="connection-badge" class="badge unknown">Disconnected</span>
        </div>
        <div id="last-update" class="last-update">--</div>
      </div>
    </header>

    <!-- Dashboard View -->
    <main id="view-dashboard" class="dashboard view-active">
      <!-- Automation Control Section -->
      <section id="automation-section" class="dash-section hidden">
        <h2>Automation Control</h2>
        
        <div class="automation-controls">
          <div class="control-group">
            <label>Current Mode:</label>
            <span id="mode-display" class="badge unknown">--</span>
          </div>
          <div class="control-group">
            <label for="mode-selector">Set Mode:</label>
            <select id="mode-selector">
              <option value="MANUAL">MANUAL</option>
              <option value="AUTO">AUTO</option>
              <option value="IDLE">IDLE</option>
            </select>
            <button id="set-mode-button" class="btn-primary">Set Mode</button>
            <span id="mode-feedback" class="feedback"></span>
          </div>
        </div>

        <!-- Automation Health -->
        <div class="automation-health">
          <h3>Behavior Tree Status</h3>
          <div class="health-grid">
            <div class="health-item">
              <label>BT Status:</label>
              <span id="bt-status" class="badge bt-unknown">--</span>
            </div>
            <div class="health-item">
              <label>Total Ticks:</label>
              <span id="bt-total-ticks">--</span>
            </div>
            <div class="health-item">
              <label>Stalled Ticks:</label>
              <span id="bt-ticks-since-progress">--</span>
            </div>
            <div class="health-item">
              <label>Errors:</label>
              <span id="bt-error-count">--</span>
            </div>
            <div class="health-item full-width">
              <label>Last Error:</label>
              <span id="bt-last-error" class="error-text">--</span>
            </div>
          </div>
        </div>

        <div class="section-grid">\n          <!-- Parameters -->
          <div class="subsection">
            <h3>Runtime Parameters</h3>
            <div id="parameters-container" class="content-box">
              <p class="placeholder">Loading...</p>
            </div>
          </div>

          <!-- Behavior Tree -->
          <div class="subsection">
            <h3>Behavior Tree</h3>
            <div class="content-box">
              <pre id="bt-viewer" class="bt-viewer">Loading...</pre>
            </div>
          </div>
        </div>

        <!-- Event Trace -->
        <div class="subsection full-width">
          <h3>Event Trace</h3>
          <div id="event-list" class="content-box event-trace">
            <p class="placeholder">No events yet</p>
          </div>
        </div>
      </section>

      <!-- Device Status Overview -->
      <section class="dash-section">
        <h2>Device Status Overview</h2>
        <p class="section-hint">Click any device card to view full details</p>
        <div id="devices-container" class="content-box">
          <p class="placeholder">Loading devices...</p>
        </div>
      </section>
    </main>

    <!-- Devices View -->
    <main id="view-devices" class="devices-view view-hidden">
      <div class="device-selector-panel">
        <label for="device-selector" class="selector-label">Select Device:</label>
        <select id="device-selector" class="device-selector">
          <option value="">Loading devices...</option>
        </select>
      </div>
      
      <div class="device-detail-panel">
        <div id="device-detail-container">
          <p class="placeholder">Select a device from the dropdown above</p>
        </div>
      </div>
    </main>

    <!-- Telemetry View -->
    <main id="view-telemetry" class="telemetry-view view-hidden">
      <div class="telemetry-controls">
        <p class="telemetry-notice">
          <strong>Note:</strong> If the embedded view is blocked, 
          <a href="http://localhost:3001" target="_blank" rel="noopener noreferrer" class="external-link">
            open Grafana in a new tab →
          </a>
        </p>
      </div>
      <div class="telemetry-iframe-container">
        <iframe 
          id="grafana-iframe" 
          src="about:blank"
          frameborder="0"
          sandbox="allow-same-origin allow-scripts allow-forms allow-popups"
          title="Grafana Telemetry Dashboard">
        </iframe>
      </div
      </section>
    </main>

    <footer>
      <div id="last-error" class="error-banner hidden"></div>
    </footer>

    <script type="module" src="js/app.js?v=20260209"></script>
  </body>
</html>

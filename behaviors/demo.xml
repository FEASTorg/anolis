<?xml version="1.0"?>
<root BTCPP_format="4">
    <!-- 
     Demo Behavior Tree
    
    This BT demonstrates basic automation with anolis-provider-sim:
    1. Check tempctl0 temperature quality
    2. Read temp_setpoint parameter from config
    3. Ramp through multiple temperature setpoints
    4. If STALE/FAULT, log and halt
    
    Device: tempctl0 (simulated temperature controller)
    Signals: temperature (current temp reading)
    Functions: set_target_temp(target: double)
    
    -->

    <BehaviorTree ID="TempRampSequence">
        <Sequence>
            <!-- Check if temperature signal is available and OK quality -->
            <CheckQuality
                device_handle="sim0/tempctl0"
                signal_id="temperature"
                expected_quality="OK"
                name="VerifyTempSensorQuality" />

            <!-- Read temp_setpoint parameter -->
            <GetParameter
                param="temp_setpoint"
                value="{target_temp}"
                name="ReadTempSetpoint" />

            <!-- Ramp to parameter-defined setpoint -->
            <Sequence>
                <CallDevice
                    device_handle="sim0/tempctl0"
                    function_name="set_target_temp"
                    arg_target="{target_temp}"
                    success="{call_success}"
                    error="{call_error}"
                    name="SetTargetTempFromParameter" />

                <ReadSignal
                    device_handle="sim0/tempctl0"
                    signal_id="temperature"
                    value="{current_temp}"
                    quality="{temp_quality}"
                    name="ReadCurrentTemp" />
            </Sequence>

            <!-- Ramp to 30Â°C (hardcoded example) -->
            <Sequence>
                <CallDevice
                    device_handle="sim0/tempctl0"
                    function_name="set_target_temp"
                    arg_target="30.0"
                    success="{call_success}"
                    error="{call_error}"
                    name="SetTargetTemp30C" />

                <ReadSignal
                    device_handle="sim0/tempctl0"
                    signal_id="temperature"
                    value="{current_temp}"
                    quality="{temp_quality}"
                    name="ReadCurrentTemp30" />
            </Sequence>
        </Sequence>
    </BehaviorTree>
</root>